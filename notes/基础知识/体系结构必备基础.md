# 缓存

推荐阅读：[缓存](https://blankspace.blog.csdn.net/article/details/115351358)

缓存性能的重要指标包括命中率和失效率。

由于磁盘I/O的延时较长，软件栈中的很多层级通过缓存读取和缓存写入来试图避免这一点。

| 缓存 | 样例 |
|:----:|:----:|
| 客户端缓存 | 网络浏览器缓存 |
| 应用程序缓存 |  |
| Web服务器缓存 | Apache缓存 |
| 缓存服务器 | Memcached |
| 数据库缓存 | MySQL缓冲区高速缓存 |
| 目录缓存 | DCache |
| 文件元数据缓存 | inode缓存 |
| 文件系统缓冲区高速缓存 | 缓冲区高速缓存 |
| 文件系统主缓存 | 换页缓存、ZFS ARC |
| 文件系统次缓存 | ZFS L2ARC |
| 设备缓存 | ZFS vdev |
| 块缓存 | 缓冲区高速缓存 |
| 磁盘控制器缓存 | RAID缓存 |
| 存储阵列缓存 |  |
| 磁盘内置缓存 |  |

基于不同的系统和环境，缓存的类型会有较大的不同。

## 缓存管理算法

缓存管理算法和策略决定了在有限的缓存空间内存放哪些数据：
- MRU：最近最长使用算法
- LRU：最近最少使用算法
- MFU：最常使用算法
- LFU：最不常使用算法
- NFU：不常使用算法

缓存的热度是指缓存的冷或热。提高缓存热度的目的就是提高缓存的命中率。
- 冷：冷缓存是空的，或者填充的是无用的数据。冷缓存的命中率是0，开始变暖时略高于0。
- 温：温缓存填充了有用的数据，命中率还没达到预想的高度。
- 热：热缓存大量填充有用的数据，有着较高的命中率。

当缓存被初始化后，开始是冷的，过一段时间后逐渐升温。如果缓存较大或者下一级的存储较慢，会需要一段较长的时间来填充缓存使其升温。

## 缓存性能优化

常见的缓存性能优化方法：
1. 小而简单的第一级缓存，用以缩短命中时间、降低功率。
2. 采取路预测以缩短命中时间。
3. 实现缓存访问的流水化，以提高缓存带宽。
4. 采用无阻塞缓存，以提高缓存带宽。
5. 关键字优先和提前重启动以降低缺失代价。
6. 合并写缓冲区以降低损失代价。
7. 采用编译器优化以降低缺失率。
8. 对指令和数据进行硬件预取，以降低缺失代价或缺失率。
9. 对编译器进行控制预取，以降低缺失代价或缺失率。
10. 采用HBM技术增加存储层次。

## 缓存调优策略

各级缓存的通用调优策略：
1. 尽量将缓存放在栈的顶端，靠近工作开展的地方，以降低缓存命中的操作开销。这个位置也应该有更多可用的元数据，可以用来改进缓存的保留策略。
2. 确认缓存开启并确实在工作。
3. 确认缓存的命中/失效比例和失效率。
4. 如果缓存的大小是动态的，确认它的当前大小。
5. 针对工作负载调整缓存的可调参数。
6. 针对缓存调整工作负载，减少对缓存不必要的消耗。

# 操作系统

推荐阅读：[操作系统](https://blankspace.blog.csdn.net/category_9500428.html)


